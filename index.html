<!-- CONFIG - by SocialWall.me
1/ Update your Background (:16)
2/ Update your Logo (:87)
3/ Update your Title (:88)
4/ Update your Access Token (:105)
5/ Update your Post ID (:106) -->
<!-- Original source code: https://gist.github.com/anonymous/7073ea6c601f28aa65e5a077ef875526 -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>My Facebook Reactions - SocialWall.me</title>
	<style>
        html {
          box-sizing: border-box;
          width: 100%;
          height: 100%;
          margin:0;
          padding:0;
          background: url("background.png") no-repeat center fixed; /* YOUR BACKGROUND URL HERE */
          -webkit-background-size: cover;
          background-size: cover;
        }
		*, *:before, *:after {
		  box-sizing: inherit;
		}
		body{
			margin: 0;
            font-family: 'Open Sans', sans-serif;
            color: #333;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.3)
		}
        header {
            text-align: center;
        }
        header .logo {
            position: relative;
            margin:100px auto 20px;
            width:250px;
        }
        h1 {
            text-align: center;
            width:100%;
            font-size: 50px;
            padding: 30px 0;
            margin:0;
            color:#fff;
        }
				.isCentered {
					display: flex;
					margin: auto;
					justify-content: center;
					padding-top: 20px;
				}
				.bordering-carl {
					border:15px solid #5890FF;
					border-radius: 50%;
				}
				.bordering-richy {
					border:15px solid #F25268;
					border-radius: 50%;
				}
				.bordering-sex {
					border:15px solid #FFD972;
					border-radius: 50%;
				}
				.bordering-rico {
					border:15px solid #FFD972;
					border-radius: 50%;
				}
				.bordering-knacky {
					border:15px solid #FFD972;
					border-radius: 50%;
				}
				.bordering-paul {
					border:15px solid #F5706B;
					border-radius: 50%;
				}

		#wrap{
			position: relative;
			margin: 0px auto;
			width: 1280px;
			height: 720px;
		}
        .tc {
            text-align: center;
            font-size: 3rem;
            font-weight: bold;
        }
        .wf {
            width: 28%;
        }
        .wf img.illu {
            width:80%;
            display: block;
            margin: 20px auto;
            position: relative;
        }
        .wf img.emoji  {
            width:34px;
            display: inline-block;
            margin-right:20px;
        }
        .wf {
            width: 29.3%;
            float:left;
            margin:30px 2%;
            border:solid 1px #eee;
            background:#fff;
            border-radius: 8px;
            position: relative;
            text-align: center;
        }
				.videoRight {
					display: block
				}
				.container {width: 300}
	</style>
</head>
<body>
    <header>
        <!-- <img class="logo" src="socialwall.me-logo.png">-->
				<h1 id="comments" style="padding-top: 50px">Quel DJ devrait changer de nom ?</h2>
    </header>
		<div class="container">

			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>
			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>
			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>
			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>
			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>
			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>

		</div>

		<div class="container">

			<div class="videoRight">
				<iframe class="" width="300" height="100" src="https://www.youtube.com/embed/bk6Xst6euQk" frameborder="0" allowfullscreen></iframe>
			</div>

		</div>


    <script src="jquery.min.js"></script>
    <script src="lodash.min.js"></script>
    <script>
    "use strict";
		var access_token = 'EAACEdEose0cBAN7IiKiF8owvarjPw1KGTWZAHdHvOdTn78MB3V3uk618KyYwbpEStcO2q2xQGWjpwYZBLCY7F318nII5NUNRI23cM2nWGWIvApJfrLJvkz7Df5EOVkoXj3LnsfajavvLL2s7vJpsJdRh4NJ2PQea3PIuYoIgZDZD'; // PASTE HERE YOUR FACEBOOK ACCESS TOKEN
    var postID = '538590393006060'; // PASTE HERE YOUR POST ID
    var refreshTime = 5; // Refresh time in seconds
    var defaultCount = 0; // Default count to start with
    var reactions = ['LIKE', 'LOVE', 'WOW', 'HAHA', 'SAD', 'ANGRY'].map(function (e) {
        var code = 'reactions_' + e.toLowerCase();
        return 'reactions.type(' + e + ').limit(0).summary(total_count).as(' + code + ')'
    }).join(',');

    var	v1 = $('.likes .counter'),
      	v2 = $('.happy .counter'),
        v3 = $('.sad .counter'),
        v4 = $('.fml .counter'),
        v5 = $('.angry .counter'),
        v6 = $('.shock .counter');


		v1.text(defaultCount);
		v2.text(defaultCount);
		v3.text(defaultCount);
		v4.text(defaultCount);
		v5.text(defaultCount);
		v6.text(defaultCount);

		var winnerCount = []
		var count = 0
		var v0 = $('.WaouhWins')
		$("#winnerLike").hide();
		$("#winnerLove").hide();
		$("#winnerHaha").hide();
		$("#winnerWow").hide();
		$("#winnerSad").hide();
		$("#winnerAngry").hide();
		var commentList = null
		var lastCommentList = {}
		var uniqueComment = []
		var expressionURL = /[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi;
		var regexURL = new RegExp(expressionURL);
		function countOccurence(arr) {
		    var a = [], b = [], prev;

		    arr.sort();
		    for ( var i = 0; i < arr.length; i++ ) {
		        if ( arr[i] !== prev ) {
		            a.push(arr[i]);
		            b.push(1);
		        } else {
		            b[b.length-1]++;
		        }
		        prev = arr[i];
		    }

		    return [a, b];
		}
		var occurences = {}

    function refreshCounts() {
				var urlComments = 'https://graph.facebook.com/v2.8/?ids=' + postID + '&fields=comments' + '&access_token=' + access_token;
				$.getJSON(urlComments, function(res){
					commentList = res[postID].comments.data
					lastCommentList = {}
					lastCommentList[commentList[0].from.id] = commentList[0].message
					commentList.reduce(function(prev, current) {
						lastCommentList[current.from.id] = current.message
					});
					uniqueComment = []
					Object.keys(lastCommentList).reduce(function(prev, current){
						uniqueComment.push(lastCommentList[current])
					});
					console.log(uniqueComment);
					occurences = countOccurence(uniqueComment)
					console.log(occurences);
					occurences = _.countBy(uniqueComment)
					var occurencesArray = []
					_.forEach(Object.keys(occurences), function(key) {
						occurencesArray.push({message: key, count: occurences[key]})
					});
					_.orderBy(occurencesArray, 'count', 'desc')
					console.log(_.orderBy(occurencesArray));

					$("#comments").text(uniqueComment[0])
				});

        var url = 'https://graph.facebook.com/v2.8/?ids=' + postID + '&fields=' + reactions + '&access_token=' + access_token;
    	  $.getJSON(url, function(res){
					winnerCount = []

					count = res[postID].reactions_like.summary.total_count
	    		v1.text(defaultCount + count);
					winnerCount.push({id: "Like", count: count})

					count = res[postID].reactions_love.summary.total_count
					v2.text(defaultCount + count);
					winnerCount.push({id: "Love", count: count})

					count = res[postID].reactions_sad.summary.total_count
					v3.text(defaultCount + res[postID].reactions_sad.summary.total_count);
					winnerCount.push({id: "Sad", count: count})

					count = res[postID].reactions_haha.summary.total_count
					v4.text(defaultCount + res[postID].reactions_haha.summary.total_count);
					winnerCount.push({id: "Haha", count: count})

					count = res[postID].reactions_angry.summary.total_count
					v5.text(defaultCount + res[postID].reactions_angry.summary.total_count);
					winnerCount.push({id: "Angry", count: count})

					count = res[postID].reactions_wow.summary.total_count
	        v6.text(defaultCount + res[postID].reactions_wow.summary.total_count);
					winnerCount.push({id: "Wow", count: count})


				$("#winnerLike").hide();
				$("#winnerLove").hide();
				$("#winnerHaha").hide();
				$("#winnerWow").hide();
				$("#winnerSad").hide();
				$("#winnerAngry").hide();
				var theWinner = winnerCount.reduce(function(prev, current) {
					if (prev.count >= current.count) {
						return prev
					} else {
						return current
					}
				})
				$("#winner" + theWinner.id).show();
			});
    }

    $(document).ready(function(){
        setInterval(refreshCounts, refreshTime * 1000);
        refreshCounts();
    });
    </script>
</body>
</html>
